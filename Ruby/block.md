# ブロック

- ブロック

`{}` もしくは `do ~ end` 内に記述。

1行の場合は`{}`, 複数行の倍は`do ~ end`に記述するのが一般的。

ブロックは新たにスコープを作成する。

ブロックはメソッドを読み出すときのみ記述ができ、メソッド内部では`yield`という式を使用してブロック内に記述した処理を呼び出すことができる。

yieldでの呼び出し

```ruby
def func x
  x + yield
end

p func(1){ 2 + 8} # => 11
```

---

- ブロックのスコープ

ブロック内のスコープは、元のスコープ(ブロックの外)からは参照できない。

```ruby
def func y
  y + yield
end

func(1) do
  x = 2
end
p x # => undefined local variable or method `x' for main:Object (NameError)
```

ブロックはスコープを生成するのに加えて、ブロック生成時の変数をブロック内で参照することができ、その変数を更新すると、結果が外部にも影響する。

```ruby
# クロージャとしてのブロック
def func y
  y + yield
end

x = 2 # スコープ外での変数定義

p func(1) {x += 2} # => 5
p x # => 4 (元の変数にも影響している)
```

→値ではなく`変数そのもの`が共有される

このような対応づけは代入ではなく`束縛`と呼ばれる。

このように処理の生成時の環境を束縛するものを`クロージャ`と呼ぶ。

---

- ブロックの引数

ブロックは引数を受けることができ、`{}`, `do ~ end` の後で引数リストを `||` で囲む。

これらの実引数は`yield`で指定することができる。

```ruby
def func a, b
  a + yield(b, 3)
end

p func(1, 2){|x, y| x + y} # => 6
```

---

- ブロックの判定

メソッド内部でブロックが指定されたかどうかは`block_given?メソッド`で確認できる。

```ruby
def func
  return 1 if block_given?
  2
end

p func(){} # => 1
p func()   # => 2
```
